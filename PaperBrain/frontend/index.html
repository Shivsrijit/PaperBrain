<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PaperBrain - Void Hacks</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b0f19;
      --panel: #111827;
      --panel-2: #0f172a;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --primary: #6366f1;
      --accent: #22c55e;
      --warn: #f59e0b;
      --danger: #ef4444;
      --border: #1f2937;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: radial-gradient(1200px 600px at 80% -20%, #1f2937, transparent), var(--bg);
      color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    header { display: flex; align-items: center; justify-content: space-between; padding: 20px 28px; border-bottom: 1px solid var(--border); position: sticky; top: 0; background: rgba(11,15,25,0.8); backdrop-filter: blur(8px); z-index: 5; }
    .brand { display: flex; gap: 12px; align-items: center; font-weight: 700; letter-spacing: 0.3px; }
    .brand .logo { width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, var(--primary), #8b5cf6); display: grid; place-items: center; box-shadow: 0 8px 24px rgba(99,102,241,0.4);}
    .brand .logo span { font-size: 18px; font-weight: 800; }
    .container { max-width: 1100px; margin: 24px auto; padding: 0 20px 56px; }
    .grid { display: grid; grid-template-columns: 1.1fr 1.2fr; gap: 16px; }
    .card { background: linear-gradient(180deg, rgba(17,24,39,0.9), rgba(15,23,42,0.9)); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; }
    .card header { position: relative; background: transparent; border: none; padding: 16px 18px; }
    .card h3 { margin: 0; font-size: 16px; color: var(--muted); font-weight: 600; }
    .content { padding: 18px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .field { display: grid; gap: 8px; }
    label { color: var(--muted); font-size: 13px; }
    input[type="file"] { width: 100%; padding: 14px; background: #0b1220; border: 1px dashed #2a3344; border-radius: 10px; color: var(--text);}
    button { background: var(--primary); color: white; border: none; padding: 12px 16px; border-radius: 10px; cursor: pointer; font-weight: 600; box-shadow: 0 10px 22px rgba(99,102,241,0.35);}
    button.secondary { background: #1f2937; box-shadow: none; border: 1px solid var(--border);}    
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .actions { display: flex; gap: 10px; margin-top: 10px; }
    .steps { display: grid; gap: 14px; }
    .step { border-top: 1px dashed #1f2937; padding-top: 14px; }
    .badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--border); color: var(--muted); }
    .ok { color: #10b981; border-color: #064e3b; background: rgba(16,185,129,0.08); }
    .warn { color: var(--warn); border-color: #4d3210; background: rgba(245,158,11,0.08); }
    .danger { color: var(--danger); border-color: #5d1f1f; background: rgba(239,68,68,0.08); }
    pre { margin: 10px 0 0; background: #0b1220; border: 1px solid #1f2635; padding: 12px; border-radius: 10px; overflow: auto; max-height: 220px; white-space: pre-wrap; word-wrap: break-word; }
    .footer { margin-top: 20px; color: var(--muted); font-size: 12px; text-align: center; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo"><span>PB</span></div>
      <div>PaperBrain</div>
    </div>
    <div class="badge">Void Hacks</div>
  </header>
  <div class="container">
    <div class="grid">
      <div class="card">
        <header>
          <h3>Inputs</h3>
        </header>
        <div class="content">
          <div class="row">
            <div class="field">
              <label>Answer Key</label>
              <input id="answerKey" type="file" />
            </div>
            <div class="field">
              <label>Answer Sheet</label>
              <input id="answerSheet" type="file" />
            </div>
          </div>
          <div class="field" style="margin-top: 12px;">
            <label>Related Docs (multiple allowed)</label>
            <input id="relatedDocs" type="file" multiple />
          </div>
          <div class="actions">
            <button id="uploadBtn">Upload</button>
            <button id="runBtn" class="secondary">Run Pipeline</button>
          </div>
          <div id="uploadStatus" class="badge" style="margin-top:10px; display:none"></div>
        </div>
      </div>

      <div class="card">
        <header>
          <h3>Evaluator - Current Student</h3>
        </header>
        <div class="content">
          <div class="actions">
            <button id="refreshStudent">Refresh</button>
          </div>
          <pre id="currentStudent">No data yet.</pre>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px;">
      <header>
        <h3>Pipeline Outputs</h3>
      </header>
      <div class="content steps">
        <div class="step">
          <div class="badge">1. Preprocessor</div>
          <pre id="preOut">Waiting...</pre>
        </div>
        <div class="step">
          <div class="badge">2. Region Selector</div>
          <pre id="regionOut">Waiting...</pre>
        </div>
        <div class="step">
          <div class="badge">3. Text Recognition</div>
          <pre id="ocrOut">Waiting...</pre>
        </div>
        <div class="step">
          <div class="badge ok">4. Evaluator</div>
          <pre id="evalOut">Waiting...</pre>
        </div>
      </div>
    </div>

    <div class="footer">Results JSON will be created at backend agents and visualized here.</div>
  </div>

  <script>
    const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? 'http://localhost:5000' : '';

    const el = id => document.getElementById(id);
    const answerKey = el('answerKey');
    const answerSheet = el('answerSheet');
    const relatedDocs = el('relatedDocs');
    const uploadBtn = el('uploadBtn');
    const runBtn = el('runBtn');
    const uploadStatus = el('uploadStatus');

    const preOut = el('preOut');
    const regionOut = el('regionOut');
    const ocrOut = el('ocrOut');
    const evalOut = el('evalOut');
    const currentStudent = el('currentStudent');

    function showStatus(msg, cls='') {
      uploadStatus.textContent = msg;
      uploadStatus.className = 'badge ' + cls;
      uploadStatus.style.display = 'inline-flex';
    }

    uploadBtn.addEventListener('click', async () => {
      const ak = answerKey.files[0];
      const as = answerSheet.files[0];
      const rds = Array.from(relatedDocs.files || []);
      if (!ak || !as) {
        showStatus('Please select answer key and answer sheet', 'warn');
        return;
      }
      const form = new FormData();
      form.append('answer_key', ak);
      form.append('answer_sheet', as);
      rds.forEach(f => form.append('related_docs[]', f));

      showStatus('Uploading...', '');
      try {
        const resp = await fetch(`${API_BASE}/api/upload`, { method: 'POST', body: form });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || 'Upload failed');
        showStatus('Uploaded successfully', 'ok');
      } catch (e) {
        showStatus('Upload failed', 'danger');
        console.error(e);
      }
    });

    runBtn.addEventListener('click', async () => {
      preOut.textContent = 'Running preprocessor...';
      regionOut.textContent = 'Running region selector...';
      ocrOut.textContent = 'Running text recognition...';
      evalOut.textContent = 'Running evaluator...';
      try {
        const resp = await fetch(`${API_BASE}/api/run`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({}) });
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || 'Pipeline failed');

        const { results } = data;
        preOut.textContent = JSON.stringify(results.preprocessor.summary, null, 2);
        regionOut.textContent = JSON.stringify(results.region_selector.summary, null, 2);
        ocrOut.textContent = JSON.stringify(results.text_recognition.result, null, 2);
        evalOut.textContent = JSON.stringify({ ran: results.evaluator.script_ran, results: results.evaluator.results }, null, 2);
        await refreshStudent();
      } catch (e) {
        console.error(e);
        evalOut.textContent = 'Pipeline error. Check console.';
      }
    });

    async function refreshStudent() {
      try {
        const resp = await fetch(`${API_BASE}/api/results/current-student`);
        const data = await resp.json();
        if (!resp.ok) throw new Error(data.error || 'Not found');
        currentStudent.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        currentStudent.textContent = 'No current student data available.';
      }
    }
    el('refreshStudent').addEventListener('click', refreshStudent);
  </script>
</body>
</html>


